#summary !HowTo interact with Valerie

= Hauptmenü =

<br>
*Das Hauptmenü von Project Valerie: *<br><br>
http://project-valerie.googlecode.com/svn/trunk/images/main_menu_small.png

= Einstellungen =
In den Einstellungen können alle Settings zur Benutzeroberfläche und Startoptionen vorgenommen werden.
<br><br>
http://project-valerie.googlecode.com/svn/trunk/images/settings_small.png
<br><br><br><br>
= Sync =
http://project-valerie.googlecode.com/svn/trunk/images/sync_small.png
<br>
http://project-valerie.googlecode.com/svn/trunk/images/sync_options_small.png
<br>
http://project-valerie.googlecode.com/svn/trunk/images/sync_options2_small.png
<br><br>
Im Sync Menü können die Filme und Serien verwaltet, sowie neue Titel eingelesen werden.<br>
Außerdem werden hier über die Einstellungen die Suchpfade festgelegt, die Suchsprache eingestellt, oder die DB zurückgesetzt.<br><br>
*Hinweis*<br>
Die Spracheinstellung bezieht sich auf den Sync mit den Media-Providern, also in welcher Sprache der Plot gesynct wird. Die Sprache in den Menüs usw. ist abhängig von der Systemsprache der Box. 
<br><br>
Der Sync:<br><br>
Es stehen 2 Sync-Typen zur Auswahl. Eine komplette Synchronisation über die grüne Taste, sowie ein „fast Sync“ (gelbe Taste). Eine komplette Synchronisation ist zur erstmaligen Einrichtung empfohlen. Sie durchsucht die angegebenen Verzeichnisse und gleicht diese mit der DB ab. Falls die Einstellung „Film löschen wenn Datei nicht gefunden“ aktiv ist, werden die Einträge aus der DB entfernt, zu denen keine Dateien mehr gefunden werden. Die „schnelle Synchronisation“ fügt nur neue Titel hinzu, läuft dadurch auch schneller durch.
<br><br>
Als Datenquelle dienen IMDB.com, TheMovieDB.org und TheTVDB.org. IMDB liefert primär die ID. Über die anderen Quellen werden Plot, Poster, Hintergrund usw. bezogen. Liegen diese nicht in der ausgewählten Sprache vor, wird IMDB befragt. Liegen diese dort auch nicht vor, wird der englische Text von TheMovieDB, resp. TheTVDB genommen. Ist dieser dort auch nicht vorhanden, wieder Failback zu IMDB.<br>
Ist ein Titel eine TV-Aufnahme und es liegen die zugehörigen Metafiles (`*`.meta) vor, werden hieraus Titelname und ggf. Staffel/Episode für die Suche genommen, anstelle des Dateinamens.<br>
Gibt es zu einem Titel eine gleichnamige `*`.nfo Datei, wird diese nach der IMDB-ID ausgelesen.<br>
Eine Ausnahme sind Ordner mit einer DVD Struktur (`*`.vob, `*`.ifo) als Inhalt. Da hier anhand des Dateinamens keine Suche gestartet werden kann, wird der Ordnername als Suchbegriff verwendet.
<br><br>
*Hinweis*<br>
In der Datei paths.conf ist festgelegt, nach welchen Dateitypen in welchen Verzeichnissen gesucht wird, bzw. wie die Ordner kategorisiert sind:<br>
mkv|ts|avi|m2ts<br>
/hdd/movie|MOVIE<br>
/hdd/series|TV<br>
<br><br>
In der Standardkonfiguration werden die Dateitypen mkv, ts, avi und m2ts in den Ordnern /hdd/movie und /hdd/series durchsucht, die als MOVIE und TV markiert sind. <br>
Befinden sich in einem Ordner sowohl Film als auch Serientitel, so muss dieser als MOVIE_AND_TV markiert werden und Valerie versucht diese am Dateinamen richtig zuzuordnen.<br>
Die Dateityperweiterungen können selbst editiert werden, je nach vorhandenen Dateien, für die Ordnermarkierung stehen nur MOVIE, TV und MOVIE_AND_TV zur Auswahl.<br><br>

= Live TV =
Hier gelangt man – wie der Name schon sagt – wieder zurück zum normalen Live-TV<br><br>
= Filme =
http://project-valerie.googlecode.com/svn/trunk/images/movie_mini.png<br>
Falls der Plot nicht komplett in die Darstellung passt, kann über die INFO Taste der Plot extra dargestellt werden.<br><br>

Es können über die *rote Taste* verschiedene Filter zu Darstellung der Titelliste gesetzt werden <br> (sortiert nach Name, nach Release Jahr, nach Erstellungsdatum im Dateisystem und nach Beliebtheit.<br>
http://project-valerie.googlecode.com/svn/trunk/images/sort_red.png<br><br>

Über die *blaue Taste* können Filter für das Genre gesetzt werden. Diese erweitern sich, je nach Genre der gesyncten Titel automatisch.
http://project-valerie.googlecode.com/svn/trunk/images/sort_blue.png<br><br>
<br><br>
= TV Shows =
http://project-valerie.googlecode.com/svn/trunk/images/series_mini.jpg<br>
Es gelten die gleichen Tasten wie bei "Filme"
<br><br>
= Config und Datenbank =
Configuration Files für Valerie:<br>
/media/valerie/pre.conf (Regular Expressions für das Anpassen der Suchstrings)<br>
/media/valerie/post_movie.conf (Regular Expressions für das Anpassen der Suchstrings)<br>
/media/valerie/post_tv.conf (Regular Expressions für das Anpassen der Suchstrings)<br>
/media/valerie/valerie.conf (div. Konfigurationen für Valerie, z.B. Startverhalten, etc)<br>
/media/valerie/paths.conf (Suchpfade und Flags für die Suchordner)<br>
/media/valerie/blacklist.conf (gelöschte Filme)<br>
<br>
Der Dateiname eines Titels ist für IMDB und Co. nicht immer eindeutig. Gerade wenn er etwas kryptisch ist, kommen Suchergebnisse zu Stande, die mit dem Film nichts gemein haben. Hierfür gibt es die pre.conf, sowie post_movie.conf und post_tv.conf. Dort können Regular Expressions eingetragen werden, die helfen den Namen eines Titels vor der Suche etwas „aufzubereiten“.<br>
Die pre.conf gilt für beide Kategorien, post_movie.conf nur für Filme, post_tv.conf nur für Serien.<br><br>

Beispiel:<br>
Angenommen der Titel hat folgenden Dateinamen:<br> „The.Beach.2000.720p.HDTV.x264-ESiR.mkv“<br>
Valerie würde mit Standardeinstellungen folgendes als Suchstring verwenden: „The Beach 2000 ESiR“<br>
Da das Ergebnis nicht eindeutig ist, wird der „best match“ verwendet. In diesem Fall „Beach Tennis USA: The Road to Long Beach 2009“. Um dem vorzubeugen, können über die Regular Expressions bestimmte Wörter oder Zeichenketten herausgefiltert werden, damit ein möglichst eindeutiger Suchbegriff übergeben wird.<br>
Mehr zu Regular Expressions kann auf [http://www.zdnet.de/anwendungsentwicklung_regular_expressions_syntax_entraetselt_story-20000201-20000839-1.htm ZDNET] nachgelesen werden
<br><br>
Spezielle Files:<br>
<…>/medienordner/valerie.info<br>
Um einen bestimmten Ordner von der Suche zu auszuschließen, muss in diesem Ordner eine Datei namens „valerie.info“ angelegt werden, die als Inhalt das Wort IGNORE hat.<br><br>

/media/valerie/start.sh <br>
Hier können Shell befehle hinterlegt werden, die beim Start von Valerie abgearbeitet werden (ich lasse z.B. meine NAS hierüber starten und mounten)<br><br>

Datenbank Files:<br>
/media/valerie/movies.db (alle Filmtitel)<br>
/media/valerie/tvshows.db (alle Serientitel)<br>
/media/valerie/episodes.db (die einzelnen Episoden)<br>
/media/valerie/failed.db (beim Sync fehlgeschlagene Titel)<br>
<br><br>
= Valerie Log =
Das Valerie Log ist über den Browser erreichbar. Einfach die Box IP + festgelegten Port in den Browser eingeben. Alle gefundenen Valerie Logs werden aufgelistet und können herunter geladen werden. <br>
Bsp: <br>
http://192.168.0.100:8888 <br><br>
http://project-valerie.googlecode.com/svn/trunk/images/Val_log.png<br><br>
= Cover und Backdrops =
Poster und Backdrops werden in „/…/valerie/media“ abgelegt. Falls man diese selbst erstellen möchte, sind folgende Tools nötig:<br><br>

Cover<br>
-	convert.exe aus dem [http://www.imagemagick.org/script/binary-releases.php#windows Image-Magic Paket]<br>
-	[http://www.libpng.org/pub/png/apps/pngquant.html pngquant]<br>
Die Wunsch JPG´s in einem bestimmten Verzeichnis richtig benannt (IMDB-ID`_`poster.jpg) ablegen.<br>
Den folgenden Code in einer `*`.bat, oder direkt in der Eingabeaufforderung ausführen, allerdings dann aus den doppelten Prozentzeichen nur eines machen:<br>
{{{
FOR /F "delims=." %%a IN ('dir /b <path_to_jpg>\*_poster.jpg') do (<path_to_convert>\convert.exe -resize 156x214! -depth 256 <path_to_jpg>\%%a.jpg <export_path_for_png>\%%a.png & <path_to_pngquant>\pngquant.exe 256 <export_path_for_png>\%%a.png & del <export_path_for_png>\%%a.png & move <export_path_for_png>\%%a-fs8.png <ready_to_use_png>\%%a.png)
}}}

<br><br>
Backdrops<br>
-	ffmpeg von [http://ffmpeg.arrozcru.org/autobuilds/ffmpeg/mingw32/static/ ffmpeg.arrozcru.org]<br>
Vorhegen ist das Gleiche wie bei den Covers, allerdings als IMDB-ID`_`backdrop.jpg ablegen.<br>
Den folgenden Code in einer `*`.bat, oder direkt in der Eingabeaufforderung ausführen, allerdings dann aus den doppelten Prozentzeichen nur eines machen:<br>
{{{
FOR /F "delims=." %%a IN ('dir /b <path_to_jpg>\*_backdrop.jpg') do ("<path_to_ffmpeg>\ffmpeg" -i <path_to_jpg>\%%a.jpg -an -f mpeg2video -r 30.0 -vcodec mpeg2video -intra -sc_threshold 1000000000 -flags +mv0+cgop -dc 8 -g 1 -me_method zero -qscale 5 -bf 0 -aspect 16:9 <path_for_output>\%%a.m1v)
}}}
<br><br>
Die erstellten Dateien können dann in das Verzeichnis in „/…/valerie/media“ auf der Box kopiert werden.<br><br>

= Animiertes Hauptmenü =
Dieses Feature wird bis jetzt nur vom blackSwan Skin unterstützt.
Hierzu einfach unter */hdd/valerie/dreamscene/* einen animierten Hintergründ (Siehe Downloadlink weiter unten) als *blackSwan.mp4* abspeichern.

Alternativ lässt sich dieses Feature auch für andere Skins von Hand freischalten. Hierzu muss die verwendete skin.xml aus dem entsprechenden Skin-Verzeichnis editiert werden. (z.B. ProjectValerie/skins/default/1280x720/skin.xml)<br>
In der Sektion „<!-- PVMC Main Menu -->“ muss folgende Zeile abgeändert werden:<br>
Von:	
{{{
    <widget name="API" text="2" position="0,0" zPosition="0" size="1,1"/>
}}}
<br>
Nach:
{{{	
    <widget name="API" text="3" position="0,0" zPosition="0" size="1,1"/>
}}}
<br>

Folgende Zeile im Anschluss einfügen:<br>
{{{
    <widget name="stillpicture_usedreamscene" text="/hdd/valerie/dreamscene/<Dateiname>.mp4" position="0,0" zPosition="0" size="1,1"/>
}}}
<br>

Das ganze sieht dann etwa so aus:<br>
{{{
<screen name="PVMC_MainMenu" position="0,0" size="1280,720" title=" " backgroundColor="#FF000000" flags="wfNoBorder"><br>
    <widget name="API" text="3" position="0,0" zPosition="0" size="1,1"/><br>
    <widget name="stillpicture_usedreamscene" text="/hdd/valerie/dreamscene/blackSwan.mp4" position="0,0" zPosition="0" size="1,1"/><br>
    <widget name="showiframe" position="0,0" zPosition="0" size="1280,720" text="/usr/lib/enigma2/python/Plugins/Extensions/ProjectValerie/skins/blackSwan/background.m1v"/><br>
…
}}}
<br>
<br><br>
Den Dateinamen entsprechend ersetzen. Eine Auswahl an animierten Hintergründen ist hier zu finden:<br>
http://duckbox.info/files/public/val/dreamscene/

<br><br>