#summary Everything about synchronisation
<wiki:toc max_depth="2" />
----
= Synchronisation =
The synchronisation is done using the synchronisation manager, which can be entered by performing the following steps from the main menu: "System" => "Synchronize". There are two different synchronisation types available:
 * a full synchronisation (available through the green option key)
 * a fast synchronisation (available through the yellow option key)

The full synchronisation option is suggested if you're running PVMC for the first time. By doing so the directories defined in the search path are scanned and the contained movie files will be added to the database. If the option "Delete movie if file not found" from the main settings is selected, the related entries from the database will be removed if the related media files are not found any more.

Please note, that you can leave the synchronisation manager while the synchronisation process is still in progress: just press the "Exit" key after you initiated a synchronisation run and the synchronisation process will be performed in the background. A pop-up message is displayed in order to notify you right after the synchronisation process has been finished!

The "fast synchronisation" will only add new titles to the database. hence this option is much faster compared to the full synchronisation option.<br><br>
http://project-valerie.googlecode.com/svn/trunk/images/sync_small.png
<br><br>
== Settings ==
The synchronisation manager settings can be entered using the [blue] key. There you can specify the search path and the language to be used for both the plots and titles. Additionally you can reset / delete the database, cache and filters.

*Note: after modification of any synchronisation setting (especially after change of synchronisation language) a new sync-run has to be performed!*
<br><br>
== Media provider ==
The data for plot, title, genre etc. is retrieved from [http://www.imdb.com IMDB.com], [http://www.themoviedb.org TheMovieDB.org (TMDB)] and [http://www.thetvdb.org TheTVDB.org (TVDB)]. While IMDB is used to uniquely identify the movie (and hence for retrieving the unqiue IMDb-ID) the two remaining sources are used to retrieve Plots, Poster, Backdrops etc.
The search order used by PVMC is as follows:
 * first of all TMDB, resp. TVDB are asked for the plot in the language defined in the synchronisation manager options (= local language)
 * if no plot for the local language is found, PVMC will check IMDB for a plot in the local language 
 * if the IMDB search fails, too PVMC will check TMDB / TCVDB for the english plot
 * finally PVMC will check IMDB for an english plot
Please note, that poster and backdrops will only be retrieved from TMDB and TVDB. If there are no poster and backdrops available for your movie, then no arts will be displayed later on in the movie lists! If this happens for one some of your movies then it is suggested to just open an account at TMDB and 7 TVDB in order to upload some arts for the desired movies. By doing so everyone has a benefit! :-) 
<br><br>
== Search structures ==
The file `paths.conf` is used to define both the file extensions to be used in order to detect media files (for example "`mkv|ts|avi|m2ts`") and the directories that should be searched together with their categories (movies => category "MOVIE", TV-shows => category "TV" or both => category "MOVIE_AND_TV"). This file can either get edited manually (a file containing some default values will be copied during installation to `/hdd/valerie` - see also => [Resources#Configuration_files configuration files]) - by using the corresponding setting in the synchronisation manager options. Additionally one can specify for every directory, whether the file names shall be used for synchronisation - or the name of the corresponding directory.

The video collection could look for example like the following:
 * `/hdd/movie` => category "MOVIE"
 * `/hdd/series` => category "TV"
 * `/hdd/mixed` => category "MOVIE_AND_TV"
After a full synchronisation the files contained in directory "`/hdd/movie`" will be added to the "Movie"-list. The files contained in directory "`/hdd/series`" will be recognized as episodes for series / TV shows and the files contained in the "`mixed`" directory will be parsed as movie - and if that doesn't succeed another try will be started as TV-show.

The following criteria will be used in order to parse a file:
 * the name of the file without extension (default). The string used for the search query (= search string) can be modified using regular expressions prior executing the search itself (see below)
 * the name of the directory containing the media file (this can be configured in the synchronisation manager options ([Sync#Settings s.o.])
 * an IMDb-ID either provided in the file name itself - or by using an `nfo`-file (see below)
 * if the media is an Enigma2 recording then the related Enigma2 `meta`-file is used in order to retrieve movie name and / or series name and episode name 
Wrong parsed entries can be corrected manually later on by either using the PVMC GUI or WebIf ([Sync#Fix_wrong_parsed_media see below]).
<br>
=== DVDs ===
Normally PVMC detects movies split into several files by name. An exception to this rule are directories containing a DVD structure (`*`.vob, `*`.ifo). Since it is not possible to built a search string out of the file name the directory name is used instead.
<br>
=== Fix wrong parsed media ===
English translation in progress - please be patient... :-)

There are several ways in order to fix wrong detected movies / TV show episodesIn case of one or several movies have been parsed wrong Wurde ein Titel nicht oder falsch erkannt, so kann dies über den Punkt "Verwalten" im Menu des Synchronisations-Manager korrigiert werden. Ausserdem kann man gezielt einzelne Filme dort aktualisieren, oder aus der Datenbank löschen. Dazu muss der jeweilige Film (entsprechenen aus der Rubrik "Fehlgeschlagen|Filme|TV Shows|TV Shows (all)") ausgewählt und mit OK bestätigt werden.
Dann kann man entweder über "Alternativen" das richtige Suchergebnis auswählen und bestätigen (sofern nicht als UNKNOWN markiert), oder aber gezielt die IMDB-ID (über "MORE") eingeben und speichern.
<br><br>
http://project-valerie.googlecode.com/svn/trunk/images/manage_small.png<br>
<br>
*HINWEIS:*<br>
Besteht ein Titel aus mehreren Dateien, so wird nur der erste Teil in die Datenbank aufgenommen, die anderen Teile landen in der failded.db. Wird der erste Teil abgespielt, so startet im Anschluss an den ersten der nächste Teil. Damit Valerie erkennt, dass es sich um Multipart Titel handelt, muss eine der folgenden Syntaxmöglichkeiten (+ laufende Nummer, startend mit 1) verwendet werden:<br>
  * disk<br>
  * cd<br>
  * dvd<br>
  * part<br>
  * pt
<br>
z.B: Film XY - disk1.avi, Film XY - disk2.avi
<br><br>
== Excludes and search hints ==
PVMC offers several options in order to affect the parse process and thus to control what is synced and how:

 * exclude whole folders from search process - even if they are contained in the search path
 * provide the IMDb-Id within the media file name 
 * provide the IMDb-Id in a dedicated `*.nfo`-file
 * define search phrases for whole directories
 * define meta information in a dedicated (XBMC-sytle) `*.nfo`-file
 * using regular expressions 

The upcoming chapters will describe these options more detailed. But please keep in mind, that it is suggested to always perform a full sync after you added / modified search hints in order to rebuilt the database - perhaps also deleting the database would be helpful to eliminate the risk of getting side effects caused by old entries.   
=== Exclude folders from parsing ===
A whole folder and his subfolders can be excluded from the parse process by simply adding a new file `ignore` to the folder which should be excluded.

=== Provide IMDb-ID within the file name ===
It is possible to provide the IMDb-ID for a video by specifying the ID in the file name of the related media file:

*file name of the media file (old):* {{{WrongDetectedMovie.avi}}}

*file name of the media file (new):* {{{WrongDetectedMovie_tt1234567.avi}}}

*Please note:* the underscore "`_`" given in the example above is not mandatory. Additionally the location of the IMDb-ID doesn't matter at all, but it has to be ensured, that the ID starts with "`tt`", followed by seven digits. besides that it is important to know, that an IMDb-ID provided by the file name, will be overwritten by the IMDb-ID provided by nfo-file (see upcoming chapter).

=== IMDb ID provided by nfo-file===
Another possibility to provide the correct IMDb-ID for wrong parsed media is a so-called "nfo"-file. Such a file has to be located in the same directory as the media file and it has to have the same name as the media file, but the extension has to be "`nfo`". The content of the file is just the IMDb-ID, but it is important that currently _two lines_ have to be contained in the file! For example:

*file name of the video file:* {{{WrongDetectedMovie.avi}}}

*file name of the nfo-file:* {{{WrongDetectedMovie.nfo}}}

*content of the nfo-file:*

<code>tt1234567
</code>

Please note: it doesn't matter if there is additional text preceding the IMDb-ID, for example the complete link for this movie to IMDb could be contained in the nfo and it would still work:

*Alternative content of the nfo-file:*

<code>http://www.imdb.com/title/tt1234567/

</code>

=== Search string for whole directories ===
Besides the above mentioned possibilities another option would allow for the definition of search strings used for the whole directory. This is especially helpful in case of TV-shows since otherwise you'd have to provide a nfo-file for each single episode. 
To do so, just add a new `valerie.info` to the corresponding directory containing the word to be used for search. As mentioned above the search query should return an ambiguous result in order to enhance the parse results.

*Please note:*
The search string provided using this way is only valid for the current directory, but not for contained sub-directories.

Using a valerie.info it's additionally possible to define the following IDs for the whole folder:
 * the IMDb-ID
 * the TheTvDB-ID
 * or both IDs together

Sample content for valerie.info used to specify the IMDb-ID for the current directory:

<code>tt1234567
</code>

Sample content for valerie.info used to specify the TheTvDB-ID for the current directory:

<code><tvdb>tvdb12345
</code>

Sample content for valerie.info used to specify both the IMDb-ID and the TheTvDB-ID for the current directory::

<code>tt1234567 <tvdb>tvdb12345
</code>

=== XBMC-style nfo-files ===
Additionally to the previously mentioned nfo-files used to provide just the IMDb-ID it's planned to support nfo files containing the whole set of meta attributes used by PVMC. Currently at lest the following attributes are supported:
 * `<id>` => IMDb-ID for movies
 * `<episodedetails>` => IMDb-ID for episode
 * `<season>` => season # for TV-shows
 * `<episode>` => episode # for TV-shows
 * `<year>` => year
Upcoming releases of PVMC will support also reading of plot, title, genres etc. from nfo. These files can be created and edited by additional software, e.g. Ember Media Manager. By doing so it would be possible to also add media files not available at IMDb. Additionally this would be an easy way to have database independent backup of the meta information of your collection.

=== Regular expressions ===
Before a search query is started the used search string can be adapted using regular expressions. These regular expressions can be defined in the following configuration files: "`pre.conf`", "`post_movie.conf`" and "`post_tv.conf`":
 * `pre.conf` is used for both movie and TV shows
 * `post_movie.conf` is only applicable for movies
 * `post_tv.conf` is only applicable for TV shows.<br>
Example:<br>
Assuming a media file has the following file name:<br> "`The.Beach.2000.720p.HDTV.x264-ESiR.mkv`"<br>
By default PVMC would use the following string as search string: "`The Beach 2000 ESiR`"<br>
Since the returned result is ambiguous PVMC would use the first result returned (i.e. the "best match") which in this case is "`Beach Tennis USA: The Road to Long Beach 2009`". In order to avoid such wrong parse-results it is possible to filter specific words by using regular expressions to get the correct media returned as first result.<br>
More on regular expressions can be found on [http://www.zdnet.de/anwendungsentwicklung_regular_expressions_syntax_entraetselt_story-20000201-20000839-1.htm ZDNET]. In order to check and test regular expressions written on your own the following online tool is very helpful: [http://gskinner.com/RegExr RegEx Tool]<br>
<br>