#summary Alles rund um's Synchronisieren
<wiki:toc max_depth="2" />
----
= Synchronisieren =
In den Synchronisierungsmanager gelangt man über "Hauptmenu" => "System" => "Synchronize". Es stehen zwei Sychronisationsarten zur Auswahl:
 * eine komplette Synchronisation (auswählbar über die grüne Taste)
 * eine "schnelle" Synchronisation (auswählbar über die gelbe Taste

Die komplette Synchronisation ist zur erstmaligen Einrichtung empfohlen. Sie durchsucht die im Suchpfad angegebenen Verzeichnisse und gleicht die dort gefundenen Medien-Dateien mit der Datenbank ab. Falls die Option "Film löschen wenn Datei nicht gefunden" aus den Haupteinstellungen aktiv ist, werden diejenigen Einträge aus der Datenbank entfernt, zu denen keine Dateien mehr gefunden wurden.

Die "schnelle Synchronisation" hingegen fügt nur neue Titel hinzu und läuft dadurch bedeutend schneller ab.<br><br>
http://project-valerie.googlecode.com/svn/trunk/images/sync_small.png
<br><br>
== Einstellungen ==
Die Einstellungen für den Synchronisationsmanager sind über die blaue Taste erreichbar. Dort werden die für die Suche zu berücksichtigenden Verzeichnisse angegeben, sowie die für Plots und Titel zu verwendete Sprache festgelegt. Außerdem können dort Datenbank, Cache und Filter zurückgesetzt, bzw. gelöscht werden.
<br><br>
== Medienprovider ==
Als Datenquelle für die Synchronisation dienen [http://www.imdb.com IMDB.com], [http://www.themoviedb.org TheMovieDB.org (TMDB)] und [http://www.thetvdb.org TheTVDB.org (TVDB)]. IMDB liefert primär die ID, während über die anderen Quellen Plot, Poster und Hintergrund usw. bezogen werden.
Zu beachten ist dabei folgendes:
 * zuerst werden TMDB, bzw. TVDB nach dem Plot in der ausgewählten Sprache befragt.
 * liegt der Plot nicht in der ausgewählten Sprache vor, wird bei IMDB für die ausgewählte Sprache nachgeschaut 
 * liegt dieser dort auch nicht vor, wird der englische Text von TMDB, resp. TVDB genommen
 * ist dieser dort auch nicht vorhanden, wird nochmals nach einem englischen Plot bei IMDB geschaut
Poster und Hintergrund werden aktuell ausschließlich von TMDB, bzw. TVDB in der eingestellten Sprache geholt. Sind diese dort *nicht* verfügbar, werden später in den Listen keine Grafiken angezeigt. In diesem Fall einfach selbst bei den entsprechenden Providern die Grafiken hochladen - dann haben alle etwas davon! :-) 
<br><br>
== Suchstrukturen ==
In der Datei `paths.conf` ist festgelegt, nach welchen Dateitypen in welchen Verzeichnissen gesucht wird (z.B. Dateiendungen "`mkv|ts|avi|m2ts`"), bzw. wie die Ordner kategorisiert sind (Filme => Kategorie "MOVIE", Serien => Kategorie "TV" oder beides => Kategorie "MOVIE_AND_TV"). Diese Datei kann entweder manuell editiert werden (eine entsprechende Datei mit Default-Werten wird bei der ersten Installation unter `/hdd/valerie` angelegt - siehe => [Resources#Konfigurationsdateien Konfigurationsdateien]) - oder aber über die Einstellungen des Syncmanagers. Zusätzlich kann für jeden Ordner separat konfiguriert werden, ob der Ordnername zum Abgleich benutzt werden soll oder die Dateinamen der einzelnen Files.

Beispielsweise könnte die eigene Sammlung wie folgt aufgeteilt werden:
 * `/hdd/movie` => Kategorie "MOVIE"
 * `/hdd/series` => Kategorie "TV"
 * `/hdd/gemischt` => Kategorie "MOVIE_AND_TV"
Nach einem Synchronisationslauf würden die im "`/hdd/movie`"-Ordner enthaltenen Files zur "Film"-Liste zugeordnet. Die im "`/hdd/series`"-Verzeichnis enthaltenen Dateien werden als Serien interpretiert und die im "`gemischt`"-Ordner enthaltenen Dateien werden entweder als Film gesucht - und wenn dort nichts gefunden wird, als Serie interpretiert.

Zur Erkennung der Videos werden folgende Kriterien herangezogen:
 * der Name der Datei ohne Dateityperweiterung (default). Der für die Suchanfrage benutzte String kann aber vor Ausführen der eigentlichen Suche noch durch Reguläre Ausdrücke verändert werden (s.u.)
 * der Name des Ordners, in dem die Datei enthalten ist (einstellbar in den Synchronisationsmanager-Optionen ([Einstellungen s.o.])
 * eine IMDB-Id, die über eine selbst anzulegende `nfo`-Datei vorgegeben wird
 * bei selbst erstellten Aufnahmen wird der Titel (bzw. Staffel und Episode bei Serien) aus der zugehörigen Enigma2 `meta`-Datei gelesen
Falsch erkannte Einträge können anschließend manuell korrigiert werden ([Suchergebnis_manuell_korrigieren s.u.]).
<br>
=== DVDs ===
Valerie erkennt Filme die in mehreren Dateien vorliegen anhand des Namens. Eine Ausnahme sind Ordner mit einer DVD Struktur (`*`.vob, `*`.ifo) als Inhalt. Da hier anhand des Dateinamens keine Suche gestartet werden kann, wird in solchen Fällen immer der Ordnername als Suchbegriff verwendet.
<br>
=== Reguläre Ausdrücke ===
Mit Hilfe in den Config-Files "`pre.conf`", "`post_movie.conf`", sowie "`post_tv.conf`" festgelegten Regular Expressions können die Suchstrings, die an die Medienprovider übergeben werden, beeinflusst werden.<br>
Die `pre.conf` gilt für beide Kategorien, `post_movie.conf` nur für Filme, `post_tv.conf` nur für Serien.<br><br>
Beispiel:<br>
Angenommen der Titel hat folgenden Dateinamen:<br> "`The.Beach.2000.720p.HDTV.x264-ESiR.mkv`"<br>
Valerie würde mit Standardeinstellungen folgendes als Suchstring verwenden: "`The Beach 2000 ESiR`"<br>
Da das Ergebnis nicht eindeutig ist, wird der "best match" verwendet. In diesem Fall "`Beach Tennis USA: The Road to Long Beach 2009`". Um dem vorzubeugen, können über sogenannte "Reguläre Ausdrücke" bestimmte Wörter oder Zeichenketten herausgefiltert werden, damit ein möglichst eindeutiger Suchbegriff übergeben wird.<br>
Mehr zu regulären Ausdrücken kann auf [http://www.zdnet.de/anwendungsentwicklung_regular_expressions_syntax_entraetselt_story-20000201-20000839-1.htm ZDNET] nachgelesen werden. Um eigene reguläre Ausdrücke zu überprüfen eignet sich folgedes online [http://gskinner.com/RegExr RegEx Tool]<br>
<br>
=== Suchergebnis manuell korrigieren ===
Wurde ein Titel nicht oder falsch erkannt, so kann dies über den Punkt "Verwalten" im Menu des Synchronisations-Manager korrigiert werden. Ausserdem kann man gezielt einzelne Filme dort aktualisieren, oder aus der Datenbank löschen. Dazu muss der jeweilige Film (entsprechenen aus der Rubrik "Fehlgeschlagen|Filme|TV Shows|TV Shows (all)") ausgewählt und mit OK bestätigt werden.
Dann kann man entweder über "Alternativen" das richtige Suchergebnis auswählen und bestätigen (sofern nicht als UNKNOWN markiert), oder aber gezielt die IMDB-ID (über "MORE") eingeben und speichern.
<br><br>
http://project-valerie.googlecode.com/svn/trunk/images/manage_small.png<br>
<br>
*HINWEIS:*<br>
Besteht ein Titel aus mehreren Dateien, so wird nur der erste Teil in die Datenbank aufgenommen, die anderen Teile landen in der failded.db. Wird der erste Teil abgespielt, so startet im Anschluss an den ersten der nächste Teil. Damit Valerie erkennt, dass es sich um Multipart Titel handelt, muss eine der folgenden Syntaxmöglichkeiten (+ laufende Nummer, startend mit 1) verwendet werden:<br>
  * disk<br>
  * cd<br>
  * dvd<br>
  * part<br>
  * pt
<br>
z.B: Film XY - disk1.avi, Film XY - disk2.avi
<br><br>
== Excludes und Suchhilfen ==
Valerie bietet mehrere Möglichkeiten, das Suchergebnis zu beeinflussen:

 * komplette Ordner von der Suche ausklammern
 * die IMDb-Id im Namen der Videodatei angeben
 * die IMDb-Id in einer nfo-Datei angeben
 * Suchwörter für einen kompletten Ordner definieren
 * zusätzliche Meta-Daten in einer nfo-Datei angeben

Wie das im Detail geht, wird in den nachfolgenden Kapiteln ausführlicher beschrieben. Zu beachten ist dabei aber, dass in allen Fällen nach einer Änderung eine bereits vorhandene Datenbank durch eine *komplette* Synchronisation neu aufgebaut wird (also keine "schnelle" Synchronisation).
=== Ordner von der Suche ausklammern ===
Um einen kompletten Ordner von der Suche auszuklammern, muss man lediglich eine Datei `valerie.info` mit folgendem Inhalt im auszuschließenden Ordner erstellen:

<code>ignore</code>
=== IMDb ID aus Dateinamen auslesen ===
Wird ein Videofile nicht richtig erkannt, obwohl bei IMDb ein Eintrag dafür vorhanden ist, so ist es möglich, Valerie durch die Angabe der "richtigen" IMDb-ID auf die richtige Spur zu bringen. Dazu muss lediglich die IMDb-ID Zeichenkette (incl. den obligatorischen "tt") in den Dateinamen mit aufgenommen werden:

*Dateiname des Videofiles (alt):* {{{NichtErkannterFilm.avi}}}

*Dateiname des Videofiles (neu):* {{{NichtErkannterFilm_tt1234567.avi}}}

Der Unterstrich "`_`" ist dabei nicht zwingend notwendig - auch ist es egal, an welcher Stelle im Dateinamen die Zeichenkette steht - wichtig ist nur, dass sie mit "tt" beginnt und anschließend sieben Ziffern folgen. Außerdem ist zu beachten, dass eine IMDb-ID, die über den dateinamen mitgegeben wurde, von einer IMDb-ID, die aus einer nfo-Datei stammt, überschrieben wird (s. nächstes Kapitel).

=== IMDb ID über nfo-Datei angeben ===
Eine weitere Möglichkeit, die richtige IMDb-ID für einen nicht korrekt erkannten Film anzugeben, ist eine nfo-Datei. Diese muss im gleichen Verzeichnis wie die Film-Datei liegen und den gleichen Namen haben - allerdings mit der Dateierweiterung "`nfo`". Als Inhalt genügt die Zeichenkette für die IMDb-ID - momentan müssen allerdings _zwingend zwei Zeilen_ in der Datei enthalten sein! Beispiel:

*Dateiname des Videofiles:* {{{NichtErkannterFilm.avi}}}

*Dateiname des nfo-Files:* {{{NichtErkannterFilm.nfo}}}

*Inhalt des nfo-Files:*

<code>tt1234567
</code>

Vor der IMDb-ID kann durchaus noch weiterer Text stehen, z.B. könnte man einfach direkt den IMDb-Link zu dem Film in die Datei kopieren, was ebenfalls funktionieren sollte:

*Alternativer Inhalt des nfo-Files:*

<code>http://www.imdb.com/title/tt1234567/
</code>

=== Suchwörter für einen kompletten Ordner ===
Neben den o.g. Möglichkeiten kann mittels der Datei valerie.info ein Suchwort bereitgestellt werden, das für den gesamten Ordner gilt. Dies ist Hilfreich bei Serien, bei denen sonst für jeden Episodentitel eine eigene NFO bereit gestellt werden müsste.
Im entsprechenden Ordner muss die Datei valerie.info als Inhalt das entsprechende (und möglichst eindeutige Suchwort) enthalten, mit dem der Film auf IMDB gefunden werden kann.

*HINWEIS:*
Der bereitgestellte Suchbegriff gilt nur für den Inhalt des Ordners, aber nicht für etwaige vorhandene Unterordner.

=== Metadaten des Films aus xbmc-style nfo-File lesen ===
Zusätzlich zu der Möglichkeit, eine IMDb-ID für einen Film in einem nfo-File anzugeben, können noch weitere Attribute aus solchen Filmen gelesen werden. Zur Zeit sind das
 * `<episodedetails>` => IMDb-ID für Episoden
 * `<season>` => Staffel-Nummer bei Serien
 * `<episode>` => Episoden-Nummer bei Serien
 * `<year>` => Jahr
Diese Funktionalität ist aber noch nicht komplett implementiert, zumal mit dem "Plot"-Attribut eine wichtige Eigenschaft fehlt, um "unbekannte" Filme oder Dokumentationen unabhängig von IMDb, TheMovieDb oder TheTvDb in die PVMC-Datenbank zu bekommen.